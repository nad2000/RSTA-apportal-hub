{% extends 'base.html' %}
{% load crispy_forms_tags static i18n crispy_forms_field %}

{% block css %}
  {{ block.super }}
  <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
{% endblock %}

{% block localcss %}
  {{ block.super }}
<style>
select {padding-right: 1px;}
option {direction: rtl;}
</style>
{% endblock %}


{% block title %}{{ application }}{% endblock %}
{% block sidebar %}{% include 'sidebar.html' with categrory="reviews" %}{% endblock sidebar %}

{% block content %}

{% if page_obj.has_other_pages %}
<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
    <li class="page-item">
      <a class="page-link" href="?page=1">First</a>
    </li>
    <li class="page-item{% if page_obj.has_previous %} disabled{% endif %}">
      <a
        class="page-link"
        {% if page_obj.has_previous  %}
          href="?page={{ page_obj.previous_page_number }}"
        {% else %}
          href="#"
        {% endif %}
        tabindex="-1"
      >{% trans 'Previous' %}</a>
    </li>

    {% for p in paginator.page_range %}
      <li class="page-item{% if page_obj.number == p %} active{% endif %}">
        <a class="page-link" href="?page={{ p }}">{{ p }}</a>
      </li>
    {% endfor %}

    <li class="page-item">
      <a
        class="page-link{% if page_obj.has_next %} disabled{% endif %}"
        {% if page_obj.has_next  %}
          href="?page={{ page_obj.next_page_number }}"
        {% else %}
          href="#"
        {% endif %}
        >{% trans 'Next' %}</a>
    </li>
    <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last</a></li>
  </ul>
</nav>
{% endif %}

<form method="post">
  {% csrf_token %}
  {{ formset.management_form }}
  <table class="table" style="width: 100%;">
    <thead>
      <tr>
        <th>{% trans 'Applications' %}</th>
        <th>{% trans 'Conflict of Interests' %}</th>
        <th>{% trans 'Comment' %}</th>
      </tr>
    </thead>
    <tbody>

      {% for form in formset %}
        {{ form.id }}{{ form.panellist }}{{ form.application }}
        <tr>
          <td class="form-group" style="width: 30%; max-width: 20pc;">

            {% with a=form.instance.application|default:form.initial.application %}
              <b>

                {% if a.application_title %}
                  {{ a.application_title }}
                {% else %}
                  {{ round }}
                {% endif %}
                (<a href="{% url 'application' pk=a.id %}">{{ a.number }}</a>)

              </b>

            {% endwith %}

          </td>
          <td class="form-group" style="width: 6pc;">
            {% crispy_field form.has_conflict 'data-toggle' 'toggle' 'data-on' yes_label 'data-off' no_label 'data-onstyle' 'danger' 'data-offstyle' 'success' %}
          </td>
          <td class="form-group" style="max-width: 60%;">
            {% crispy_field form.comment %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="buttonHolder">
    <input type="submit" name="save_draft"
      value="{% trans 'Save' %}" class="btn btn btn-primary" id="submit-id-save_draft">
    <a href="{% url 'home' %}" type="button" role="button" class="btn btn-secondary" id="cancel">
      {% trans 'Cancel' %}
    </a>
    <a href="{% url 'export-score-sheet' round=view.kwargs.round %}" type="button" role="button" class="btn btn-success" id="download-score-sheet">
      {% trans 'Download Score Sheet' %}...
    </a>
    {% if is_all_coi_statements_sumitted %}
      <a href="{% url 'score-sheet' round=view.kwargs.round %}" type="button" role="button" class="btn btn-outline-success" id="download-score-sheet">
        {% trans 'Uploade Score Sheet' %}...
      </a>
    {% endif %}
  </div>
</form>

{% endblock %}

{% block javascript %}
  {{ block.super }}
  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
{% endblock %}
